<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Audio to Text Converter</title>
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<style>
body {
	background:
		url('https://www.stelizabeth.com/healthyheadlines/wp-content/uploads/2020/10/podcast-headphones-sound-bar.jpg')
		no-repeat center center fixed;
	background-size: cover;
	color: white;
	position: relative;
}

body::before {
	content: "";
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	z-index: -1;
}

.container {
	max-width: 600px;
	margin-top: 50px;
	padding: 30px;
	text-align: center;
}

.transcription-container {
	max-width: 800px;
	margin-top: 30px;
	padding: 20px;
	border-radius: 10px;
	box-shadow: 0px 0px 20px rgba(0, 255, 0, 0.3);
	display: none;
}

.transcription-text {
	max-height: 250px;
	overflow-y: auto;
	padding: 15px;
	border: 1px solid rgba(0, 255, 0, 0.5);
	border-radius: 5px;
	background: rgba(20, 20, 20, 0.9);
	color: #1DB954;
	text-align: left;
}

#loading {
	display: none;
	font-size: 18px;
	color: #1DB954;
}


#loading2 {
	display: none;
	font-size: 18px;
	color: #1DB954;
}


.spinner {
	display: inline-block;
	width: 25px;
	height: 25px;
	border: 4px solid rgba(0, 255, 0, 0.3);
	border-radius: 50%;
	border-top-color: #1DB954;
	animation: spin 1s linear infinite;
	margin-left: 10px;
}

@keyframes spin {to { transform:rotate(360deg);
	
}

}
#recordButton {
	margin-top: 2px;
}

#recordButton.recording {
	background-color: red;
}

#resetButton {
	margin-top: 10px;
	display: none;
}
</style>
</head>
<body>

	<div class="container">
		<h2 class="mb-4">Audio to Text Converter</h2>

		<!-- File Upload Form -->
		<form id="uploadForm">
			<div class="mb-3 d-flex align-items-center">
				<input class="form-control me-2" type="file" name="file"
					id="fileInput">

				<!-- Audio Recording Button -->
				<button id="recordButton" class="btn btn-danger">Record</button>
			</div>


			<div class="d-flex justify-content-center">
				<button type="button" id="resetButton"
					class="btn btn-warning me-auto" style="display: none;">Reset</button>

				<div class="form-check form-switch mt-3">
					<input class="form-check-input" type="checkbox"
						id="separateSpeakersSwitch"> <label
						class="form-check-label" for="separateSpeakersSwitch">Separate
						Speakers</label>
				</div>
			</div>



			<div class="d-flex justify-content-center mt-2">
				<button type="submit" class="btn btn-success" id="uploadButton"
					disabled>Convert to Text</button>
			</div>


		</form>





		<p id="loading" class="mt-3">
			Processing... <span class="spinner"></span>
		</p>


	</div>




	<!-- Transcription Output Box -->



	<div id="transcriptionContainer"
		class="transcription-container mx-auto">
		<h4>Transcription Result:</h4>

		<div id="result" class="transcription-text"></div>



		<form id="uploadtextForm" class="mt-4">
			<!-- Language Selection Dropdown -->
			<div id="languageContainer" class="d-flex align-items-center">
				<label for="languageSelect" class="me-2 mb-0">Select
					Language:</label> <select id="languageSelect" class="form-select w-25 me-3">
					<!-- Set width to 25% -->
					<option value="en">English</option>
					<option value="es">Spanish</option>
					<option value="fr">French</option>
					<option value="de">German</option>
					<option value="it">Italian</option>
					<option value="pt">Portuguese</option>
					<!-- Add more languages if needed -->
				</select>

				<!-- Translate Button -->
				<div id="translateContainer">
					<button id="translateButton" class="btn btn-primary">Translate</button>
				</div>
				
				
				<p id="loading2" class="ml-6">
			         Processing... <span class="spinner"></span>
		        </p>
				
			</div>
		</form>

        
                <!-- originaltext Button -->
				<div id="originaltextbuttoncontainer" style="display:none;" class="mt-4">
					<button id="originalTextButton" class="btn btn-primary">Original Text</button>
				</div>


	</div>


      




	<script>
	
	    //creating a global variable to store the transcription text
	    let transcriptionText="";
	    
	
        let mediaRecorder;
        let audioChunks = [];
        let fileInput = document.getElementById("fileInput");
        let recordButton = document.getElementById("recordButton");
        let uploadButton = document.getElementById("uploadButton");
        let resetButton = document.getElementById("resetButton");

        // Handle file selection
        fileInput.addEventListener("change", function() {
            if (fileInput.files.length > 0) {
                recordButton.disabled = true; // Disable recording if file is chosen
                uploadButton.disabled = false; // Enable upload button
                resetButton.style.display = "block";
            }
        });

        // Handle form submission (file upload)
        document.getElementById("uploadForm").addEventListener("submit", async function(event) {
            event.preventDefault();

            let formData = new FormData(this);
            let separateSpeakers = document.getElementById("separateSpeakersSwitch").checked;
            formData.append("separateSpeakers", separateSpeakers);

            let resultContainer = document.getElementById("transcriptionContainer");
            let resultText = document.getElementById("result");

            document.getElementById("loading").style.display = "block";
            resultContainer.style.display = "none";

            let response = await fetch("/api/audio/upload", {
                method: "POST",
                body: formData
            });

            let data = await response.json();

            document.getElementById("loading").style.display = "none";
            
            
            
            //storing the trancription text in a global variable
            transcriptionText=data.transcription;
            
            resultText.innerText = transcriptionText;
            resultContainer.style.display = "block";
            
            
            
            
        });
        
        
        
        
        
     // Add event listener for the Translate button
        document.getElementById("translateButton").addEventListener("click", async function() {
        	
        	let translateButton = document.getElementById("translateButton");
            translateButton.disabled = true;  // Disable button
            
            
            // Get the transcription text from the #result element
            //transcriptionText = document.getElementById("result").innerText;

            // Get the selected language from the dropdown
            let selectedLanguage = document.getElementById("languageSelect").value;

            // Show loading indicator while waiting for the translation
            document.getElementById("loading2").style.display = "block";

            // Send a POST request to the backend with the transcription and selected language
            let response = await fetch("/api/audio/translate", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    text: transcriptionText,  // Pass transcription text
                    targetLanguage: selectedLanguage  // Pass selected language
                })
            });

            // Wait for the backend response
            let data = await response.json();

            // Hide loading indicator after translation is done
            document.getElementById("loading2").style.display = "none";
            
            

            // Update the transcription text with the translated text
            document.getElementById("result").innerText = data.translatedText;
            
            //hide the form
            document.getElementById('uploadtextForm').style.display = 'none';
            
            //show the original text button
            document.getElementById('originaltextbuttoncontainer').style.display='block';

           
        });

     
     
     
     
     
     // Add event listener for the show originaltext button
        document.getElementById("originalTextButton").addEventListener("click", async function() {
        	
        	
        	// Update the translated text with the transcripted text
            document.getElementById("result").innerText = transcriptionText;
        	
        	
            // hide the original text button
            document.getElementById('originaltextbuttoncontainer').style.display = 'none';
            
            
            // show the form
            document.getElementById('uploadtextForm').style.display = 'block';
            
            // Enable button after translation
            let translateButton = document.getElementById("translateButton");
            translateButton.disabled = false;  

           
        });
  
     
     
     
       
     
     
     

        // Handle audio recording
        recordButton.addEventListener("click", async function() {
            if (recordButton.classList.contains("recording")) {
                mediaRecorder.stop();
                recordButton.classList.remove("recording");
                recordButton.textContent = "üé§ Start Recording";
            } else {
                let stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);

                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };

                mediaRecorder.onstop = async () => {
                    let audioBlob = new Blob(audioChunks, { type: "audio/wav" });
                    audioChunks = [];

                    let formData = new FormData();
                    formData.append("file", audioBlob, "recorded_audio.wav");

                    document.getElementById("loading").style.display = "block";

                    let response = await fetch("/api/audio/upload", {
                        method: "POST",
                        body: formData
                    });

                    let data = await response.json();
                    document.getElementById("loading").style.display = "none";

                    let resultContainer = document.getElementById("transcriptionContainer");
                    let resultText = document.getElementById("result");

                    resultText.innerText = data.transcription;
                    resultContainer.style.display = "block";
                };

                mediaRecorder.start();
                recordButton.classList.add("recording");
                recordButton.textContent = "‚èπ Stop Recording";

                // Disable file input when recording starts
                fileInput.disabled = true;
                resetButton.style.display = "block";
            }
        });

        // Reset Selection
        resetButton.addEventListener("click", function() {
            fileInput.value = "";
            fileInput.disabled = false;
            recordButton.disabled = false;
            uploadButton.disabled = true;
            resetButton.style.display = "none";
        });
    </script>

</body>
</html>
